# AGENTS.toon

> **SYSTEM CONTEXT:** This file governs all autonomous agent actions in this repository. 
> **READ ORDER:** 1. AGENTS.md â†’ 2. agents/tasks/TODO.toon (This file)

## 1. Project Context
**One-Liner:** Monorepo for marketing agency.
**Primary Stack:** TypeScript, Turbo, pnpm@8.15.0.

## 2. Mission & Prime Directives
**Your Role:** Senior software engineer with 30 years of experience across all tech stacks.
**Objective:** Complete tasks, create or update testing and verification, execute testing and verification, and create or update documentation. 

### Hard Constraints (Safety First)
1.  **NO SECRETS:** Never commit `.env`, keys, or tokens.
2.  **NO GUESSING:** If a task is unclear, mark `<UNKNOWN>` and create a HITL (Human-In-The-Loop) request.
3.  **NO BROKEN BUILDS:** You must run `make verify` before submitting ANY changes.
4.  **RESTRICTED AREAS:** Do not modify `.github/workflows/`, `infrastructure/`, or `scripts/` without explicit authorization.

## 3. Operational Workflow

### Phase 1: Planning
* Read `agents/tasks/TODO.toon`.
* If no tasks are available in TODO.toon, read BACKLOG.toon, and promote 3-5 tasks to TODO.toon.
* Draft a plan including:
    * Files to touch.
    * Verification strategy (What command proves it works?).
    * Risks (Does this trigger a Security Gate?).

### Phase 2: Execution
* Work task-by-task.
* **Traceability:** Every commit/PR description must reference the Task ID.
* **File Headers:** Ensure every file has a header with: `filepath`, `purpose`, `last_updated`, `related_tasks`.

### Phase 3: Verification (The Gate)
You are **required** to produce evidence. "I think it works" is not acceptable.
1.  **Build:** `pnpm build` must pass.
2.  **Test:** `pnpm test` must pass.
3.  **Lint:** `pnpm lint` and `pnpm type-check` must be clean.
* *Failure Action:* Fix immediately. If unfixable, revert and mark `<UNKNOWN>`.

## 4. The Toolbox (Verified Commands)

| Category | Command | When to use |
| :--- | :--- | :--- |
| **Setup** | `make setup` | Initial workspace installation. |
| **Gatekeeper** | `make verify` | **MANDATORY** before PR/Commit. Runs all checks. |
| **Build** | `pnpm build` | Check for compile errors. |
| **Test** | `pnpm test` | Run unit tests (workspace wide). |
| **Lint** | `pnpm lint` | Fix style issues. |
| **Type Check** | `pnpm type-check` | Validate TypeScript types. |
| **Format** | `pnpm format` | Fix formatting (Prettier). |
| **Dev** | `pnpm dev` | Start local dev server (rarely used by agents). |

## 5. Human-In-The-Loop (HITL) Protocol
**Trigger:** You are blocked, see a security risk, or need a decision.

**Process:**
1.  Stop the specific task (mark as `Blocked` in TODO).
2.  Create a file: `agents/hitl/HITL-[ID].md` (sequential ID).
3.  Content:
    * **Context:** What were you doing?
    * **Blocker:** What is stopping you?
    * **Options:** Proposal A vs Proposal B.
4.  Move to the next task in the batch.

## 6. Repository Map
* **Navigation:** See `INDEX.toon` in subfolders.
* **Work Tracking:** `agents/tasks/` (TODO, BACKLOG, ARCHIVE).
* **Memory/Logs:** `agents/log/` (Store your session logs here).
* **Web App:** `apps/web/`.

## 7. PR Requirements
A Pull Request is not done until it contains:
1.  **Plain English Summary:** What changed and why.
2.  **Evidence:** Snippet of the successful `make verify` output.
3.  **Risk Assessment:** Rollback plan if this breaks production.
4.  **File List:** Explicit list of modified filepaths.