# Finance Module - Agent Quick Reference

**Folder:** `backend/modules/finance/`
**Purpose:** Finance - billing, invoicing, payments, accounting integrations
**Layer:** Domain

## Quick Rules

✅ **Can Do:**
- Create finance models with `FirmScopedMixin`
- Add billing logic
- Add payment processing
- Add accounting integrations

❌ **Cannot Do:**
- Import from other business modules without ADR
- Break firm-scoping
- Modify payment flows without HITL
- Add external payment services without security review

⚠️ **Requires HITL:**
- **ALL changes** (money flows require HITL per Article 8)
- Payment flow changes
- Billing logic changes
- External service integrations
- Security-related changes

## Patterns

**Model:**
```python
from modules.firm.utils import FirmScopedMixin

class Invoice(FirmScopedMixin, models.Model):
    firm = models.ForeignKey('firm.Firm', on_delete=models.CASCADE)
```

**Viewset:**
```python
from modules.firm.utils import FirmScopedMixin

class InvoiceViewSet(FirmScopedMixin, viewsets.ModelViewSet):
    queryset = Invoice.objects.all()
    serializer_class = InvoiceSerializer
```

## Boundaries

**Can Import From:**
- ✅ `backend/modules/core`
- ✅ `backend/modules/firm`

**Cannot Import From:**
- ❌ `backend/modules/clients` (requires ADR)
- ❌ `backend/modules/crm` (requires ADR)
- ❌ `backend/modules/projects` (requires ADR)

**Used By:**
- `backend/api/finance`
- `frontend/src/api/finance.ts`

## Common Tasks

**Add Payment Method:**
1. **CREATE HITL ITEM FIRST** (money flows require HITL)
2. Add model if needed
3. Add payment service
4. Add tests
5. Get HITL approval before merging

## Links

- Full guide: `backend/BACKEND.md`
- Policy: `.repo/policy/SECURITY_BASELINE.md` (money flows)
- JSON context: `.agent-context.json`

---

**⚠️ CRITICAL:** All finance changes require HITL. Money flows are high-risk (Article 8).
